<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Encom Globe</title>

        <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link href="styles.css" rel="stylesheet" type="text/css" />

        <script src="include/three.min.js"></script>
        <script src="include/tween.min.js"></script>
        <script src="include/pusher.color.js"></script>
        <script src="data.json"></script>
        <script src="build/encom-globe.js"></script>

        <script>

            var globe = new ENCOM.Globe(600, 600, {
                font: "Inconsolata",
                data: data
                });

            function roundNumber(num){
                return Math.round(num * 100)/100;
            }

            function projectionToLatLng(width, height, x,y){

                return {
                    lat: 90 - 180*(y/height),
                    lng: 360*(x/width)- 180,
                };

            }

            function animate(){
                globe.tick();
                requestAnimationFrame(animate);
            }

            function start(){
                
                $(".toggle-button").click(function(e){
                    var _this = this;
                    $("#" + $(this).attr("id").split("-")[0] + "-input").slideDown(500);
                    $(".toggle-button").each(function(index, element){
                        if(_this != element){
                            $("#" + $(this).attr("id").split("-")[0] + "-input").slideUp(500);
                            console.log("hi");
                        }
                    });

                });
                $("#marker-projection").click(function(e){
                    var offset = $(this).offset();
                    var latLng = projectionToLatLng($("#marker-projection").width(), $("#marker-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                    $("#marker-lat").val(roundNumber(latLng.lat));
                    $("#marker-lng").val(roundNumber(latLng.lng));
                    $(this).data("locked", true);
                });
                $("#satellite-projection").click(function(e){
                    var offset = $(this).offset();
                    var latLng = projectionToLatLng($("#satellite-projection").width(), $("#satellite-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                    $("#satellite-lat").val(roundNumber(latLng.lat));
                    $("#satellite-lng").val(roundNumber(latLng.lng));
                    $(this).data("locked", true);
                });
                $("#connected-projection").click(function(e){
                    var offset = $(this).offset();
                    var latLng = projectionToLatLng($("#connected-projection").width(), $("#connected-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                    if(!$(this).data("first")){
                        $("#connected-1-lat").val(roundNumber(latLng.lat));
                        $("#connected-1-lng").val(roundNumber(latLng.lng));
                        $(this).data("first", true);
                    } else if (!$(this).data("second")) {
                        $("#connected-2-lat").val(roundNumber(latLng.lat));
                        $("#connected-2-lng").val(roundNumber(latLng.lng));
                        $(this).data("second", true);
                    }
                });

                $("#marker-projection").mousemove(function(e){
                    if(!$(this).data("locked")){
                        var offset = $(this).offset();
                        var latLng = projectionToLatLng($("#marker-projection").width(), $("#marker-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                        $("#marker-lat").val(roundNumber(latLng.lat));
                        $("#marker-lng").val(roundNumber(latLng.lng));
                    }
                });

                $("#satellite-projection").mousemove(function(e){
                    if(!$(this).data("locked")){
                        var offset = $(this).offset();
                        var latLng = projectionToLatLng($("#satellite-projection").width(), $("#satellite-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                        $("#satellite-lat").val(roundNumber(latLng.lat));
                        $("#satellite-lng").val(roundNumber(latLng.lng));
                    }
                });

                $("#connected-projection").mousemove(function(e){
                    var offset = $(this).offset();
                    var latLng = projectionToLatLng($("#connected-projection").width(), $("#connected-projection").height(), e.clientX - offset.left, e.clientY - offset.top);
                    if(!$(this).data("first")){
                        $("#connected-1-lat").val(roundNumber(latLng.lat));
                        $("#connected-1-lng").val(roundNumber(latLng.lng));
                    } else if(!$(this).data("second")){
                        $("#connected-2-lat").val(roundNumber(latLng.lat));
                        $("#connected-2-lng").val(roundNumber(latLng.lng));
                    }
                });
                $("#marker-projection").mouseout(function(e){
                    if(!$(this).data("locked")){
                        $("#marker-lat").val("");
                        $("#marker-lng").val("");
                    }
                    $(this).data("locked", false);
                });

                $("#satellite-projection").mouseout(function(e){
                    if(!$(this).data("locked")){
                        $("#satellite-lat").val("");
                        $("#satellite-lng").val("");
                    }
                    $(this).data("locked", false);
                });

                $("#connected-projection").mouseout(function(e){
                    if(!$(this).data("first")){
                        $("#connected-1-lat").val("");
                        $("#connected-1-lng").val("");
                    } else if(!$(this).data("second")){
                        $("#connected-2-lat").val("");
                        $("#connected-2-lng").val("");
                    }
                    $(this).data("first", false);
                    $(this).data("second", false);
                });

                $("#marker-go").click(function(){
                    globe.addMarker($("#marker-lat").val(), $("#marker-lng").val(), $("#marker-name").val());
                });

                $("#satellite-go").click(function(){
                    globe.addSatellite($("#satellite-lat").val(), $("#satellite-lng").val(), 1.3, true);
                });
                $("#connected-go").click(function(){
                    globe.addConnectedPoints($("#connected-1-lat").val(), $("#connected-1-lng").val(), $("#connected-1-name").val(), $("#connected-2-lat").val(), $("#connected-2-lng").val(), $("#connected-2-name").val());
                });

                animate();

                /* add markers at random locations */
                setInterval(function(){
                    
                    var lat = Math.random() * 180 - 90,
                       lng = Math.random() * 360 - 180,
                       name = "Test " + Math.floor(Math.random() * 100);

                    globe.addMarker(lat,lng, name);

                }, 10000);
                
                /* add 6 satellites in random locations */
                setTimeout(function(){
                    for(var i = 0; i< 2; i++){
                        for(var j = 0; j< 3; j++){
                            globe.addSatellite(50 * i - 30 + 15 * Math.random(), 120 * j - 120 + 30 * i, 1.3 + Math.random()/10);
                        }
                    }
                }, 4000);

                /* add the connected points that are in the movie */
                setTimeout(function(){
                    globe.addConnectedPoints(49.25, -123.1, "Vancouver", 35.6895, 129.69171, "Tokyo");
                }, 2000);

            }

            $(function() {

                WebFontConfig = {
                    google: {
                          families: ['Inconsolata']
                    },
                    active: function(){
                        /* don't start the globe until the font has been loaded */
                        globe.init(start);
                        $("#globe").append(globe.domElement);
                    }
                };

                /* web font stuff*/
                var wf = document.createElement('script');
                wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
                    '://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js';
                wf.type = 'text/javascript';
                wf.async = 'true';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(wf, s);

            });

        </script>

    </head>
    <body>
        <div id="container">
            <div id="globe">
            </div>
            <div id="control-panel">
                <div id ="realtime">
                    <div class="header">ADD ELEMENTS</div>
                    <div id="realtime-info">
                        <div class="btn-group btn-group-justified" data-toggle="buttons">
                            <label class="btn btn-primary active toggle-button" id="marker-button">
                                <input type="radio" name="options" id="option1"> Markers
                            </label>
                            <label class="btn btn-primary toggle-button" id = "connected-button">
                                <input type="radio" name="options" id="option2"> Connected Pt.
                            </label>
                            <label class="btn btn-primary toggle-button" id="satellite-button">
                                <input type="radio" name="options" id="option3"> Satellites
                            </label>
                        </div>
                        <div id="marker-input">
                            <img class="projection" id = "marker-projection" src="resources/point_picker.png" />
                            <div class="input-group" id="marker-lat-lng">
                                <input type="text" class="form-control" id="marker-lat" placeholder="Lat">
                                <input type="text" class="form-control"  id="marker-lng" placeholder = "Lng">
                            </div>
                            <div class="input-group">
                                <input type="text" class="form-control" id="marker-name" placeholder="Location Name (optional)" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" id="marker-go">Add Marker</button>
                                </div>
                            </div>
                        </div>
                        <div id="satellite-input">
                            <img class="projection" id = "satellite-projection" src="resources/point_picker.png" />
                            <div class="input-group" id="satellite-lat-lng">
                                <input type="text" class="form-control" id="satellite-lat" placeholder="Lat">
                                <input type="text" class="form-control"  id="satellite-lng" placeholder = "Lng">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default" id="satellite-go">Add Satellite</button>
                                </div>
                            </div>
                        </div>
                        <div id="connected-input">
                            <img class="projection" id = "connected-projection" src="resources/point_picker.png" />
                            <div class="input-group" id="connected-lat-lng">
                                <input type="text" class="form-control" id="connected-1-lat" placeholder="Lat">
                                <input type="text" class="form-control"  id="connected-1-lng" placeholder = "Lng">
                                <input type="text" class="form-control" id="connected-1-name" placeholder="Location Name (optional)" />
                                <input type="text" class="form-control" id="connected-2-lat" placeholder="Lat">
                                <input type="text" class="form-control"  id="connected-2-lng" placeholder = "Lng">
                                <input type="text" class="form-control" id="connected-2-name" placeholder="Location Name (optional)" />
                                <button type="button" class="btn btn-default" id="connected-go">Add Points</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id ="params">
                    <div class="header">CHANGE PARAMETERS</div>
                    <div id="params-info">
                        Allow users to change fundamental parameters.
                        <ul>
                            <li>colors</li>
                            <li>satellites</li>
                            <li>rotation speed</li>
                            <li>intro animations</li>
                            <li>height of markers, etc</li>
                            <li>number of points</li>
                            <li>font</li>
                            <li>globe size</li>

                    </div>
                </div>
            </div>
        </div>
    <body>
</html>

